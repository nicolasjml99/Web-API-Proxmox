<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Central 24H - Panel de VMs</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f4f4f9;
  margin:0;
  padding:0
}
header{
  background:#004080;
  color:white;
  padding:20px;
  display:flex;
  align-items:center
}
header img{
  height:40px;
  margin-right:15px
}
h1{
  margin:0;
  font-size:1.5em
}
#vm-list{
  padding:20px;
  display:flex;
  flex-wrap:wrap;
  gap:15px
}
.vm{
  border-radius:8px;
  padding:15px;
  width:250px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  background:white;
  flex-shrink:0
}
.running{
  border-left:5px solid #4caf50
}
.stopped{
  border-left:5px solid #f44336
}

/* ====== HEADER VM ====== */
.vm-header{
  display:flex;
    justify-content:space-between;
  align-items:center;
  margin-bottom:8px
}

.os-icon img{
  height:50px;
  width:auto;
}

/* ====== BOTONES ====== */
button{
  margin:3px 2px 3px 0;
  padding:5px 8px;
  border:none;
  border-radius:4px;
  cursor:pointer
}
button.console{
  background:#795548;
  color:white;
  width:100%;
  margin-bottom:10px;
  font-weight:bold
}
button.start{
  background:#4caf50;
  color:white
}
button.shutdown{
  background:#f44336;
  color:white
}
button.reboot{
  background:#ff9800;
  color:white
}
button.stop{
  background:#9c27b0;
  color:white
}
button.reset{
  background:#607d8b;
  color:white
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Central 24H Logo">
  <h1>Central 24H - Panel de VMs</h1>
</header>

<div id="vm-list"></div>

<script>
async function loadVMs(){
  const res = await fetch('/vms');
  const vms = await res.json();

  const list = document.getElementById('vm-list');
  list.innerHTML = '';

  vms.forEach(vm => {
    const div = document.createElement('div');
    div.className = `vm ${vm.status}`;

    div.innerHTML = `
      <div class="vm-header">
        <strong>${vm.name}</strong>
        <span class="os-icon">
          <img src="${vm.os === 'windows' ? 'WindowsLogo.png' : 'LinuxLogo.png'}"
            alt="${vm.os}">
        </span>

      </div>

      Estado: <b>${vm.status}</b><br><br>

      <button class="console" onclick="openProxmoxConsole(${vm.vmid})">
        üñ• Abrir Consola
      </button>

      <div>
        <button class="start" onclick="controlVM(${vm.vmid},'start')">‚ñ∂Ô∏è Start</button>
        <button class="shutdown" onclick="controlVM(${vm.vmid},'shutdown')">‚èπ Shutdown</button>
        <button class="reboot" onclick="controlVM(${vm.vmid},'reboot')">üîÑ Reboot</button>
        <button class="stop" onclick="controlVM(${vm.vmid},'stop')">‚èπ Stop</button>
        <button class="reset" onclick="controlVM(${vm.vmid},'reset')">‚ôª Reset</button>
      </div>
    `;

    list.appendChild(div);
  });
}

async function controlVM(vmid, action){
  await fetch(`/vms/${vmid}/${action}`, { method: 'POST' });
  setTimeout(loadVMs, 2000);
}

async function openProxmoxConsole(vmid){
  const res = await fetch(`/vms/${vmid}/open`);
  const data = await res.json();
  if (data.url) {
    window.open(data.url, '_blank');
  } else {
    alert('Error generando enlace de consola');
  }
}

loadVMs();
</script>

</body>
</html>